!function(e){var r={};function t(n){if(r[n])return r[n].exports;var s=r[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var s in e)t.d(n,s,function(r){return e[r]}.bind(null,s));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=4)}([function(e,r){var t,n,s=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var u,c=[],p=!1,f=-1;function l(){p&&u&&(p=!1,u.length?c=u.concat(c):f=-1,c.length&&d())}function d(){if(!p){var e=a(l);p=!0;for(var r=c.length;r;){for(u=c,c=[];++f<r;)u&&u[f].run();f=-1,r=c.length}u=null,p=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(r){try{return n.call(null,e)}catch(r){return n.call(this,e)}}}(e)}}function h(e,r){this.fun=e,this.array=r}function g(){}s.nextTick=function(e){var r=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)r[t-1]=arguments[t];c.push(new h(e,r)),1!==c.length||p||a(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=g,s.addListener=g,s.once=g,s.off=g,s.removeListener=g,s.removeAllListeners=g,s.emit=g,s.prependListener=g,s.prependOnceListener=g,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,r,t){console.log("MODE","production");t(3);const n={tvdbConfig:t(7)("./production/tvdb.config.js"),applicationConfig:t(10)("./production/application.config.js")};e.exports=n},function(e,r,t){const n=t(16);t(1);e.exports=e=>{if(!e)throw new Exception("Module is necessary");const r=n.createLogger({transports:[new n.transports.File({filename:"error.log",level:"error"}),new n.transports.File({filename:"tv-series.log"})],format:n.format.combine(n.format.label({label:e}),n.format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),n.format.prettyPrint(),n.format.splat(),n.format.printf(({timestamp:e,level:r,message:t,meta:n,label:s})=>`${e} - ${s} - [${r.toUpperCase()}] - ${t}`)),levels:n.config.npm.levels});return r}},function(e,r,t){(function(e){function t(e,r){for(var t=0,n=e.length-1;n>=0;n--){var s=e[n];"."===s?e.splice(n,1):".."===s?(e.splice(n,1),t++):t&&(e.splice(n,1),t--)}if(r)for(;t--;t)e.unshift("..");return e}function n(e,r){if(e.filter)return e.filter(r);for(var t=[],n=0;n<e.length;n++)r(e[n],n,e)&&t.push(e[n]);return t}r.resolve=function(){for(var r="",s=!1,i=arguments.length-1;i>=-1&&!s;i--){var o=i>=0?arguments[i]:e.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(r=o+"/"+r,s="/"===o.charAt(0))}return(s?"/":"")+(r=t(n(r.split("/"),(function(e){return!!e})),!s).join("/"))||"."},r.normalize=function(e){var i=r.isAbsolute(e),o="/"===s(e,-1);return(e=t(n(e.split("/"),(function(e){return!!e})),!i).join("/"))||i||(e="."),e&&o&&(e+="/"),(i?"/":"")+e},r.isAbsolute=function(e){return"/"===e.charAt(0)},r.join=function(){var e=Array.prototype.slice.call(arguments,0);return r.normalize(n(e,(function(e,r){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},r.relative=function(e,t){function n(e){for(var r=0;r<e.length&&""===e[r];r++);for(var t=e.length-1;t>=0&&""===e[t];t--);return r>t?[]:e.slice(r,t-r+1)}e=r.resolve(e).substr(1),t=r.resolve(t).substr(1);for(var s=n(e.split("/")),i=n(t.split("/")),o=Math.min(s.length,i.length),a=o,u=0;u<o;u++)if(s[u]!==i[u]){a=u;break}var c=[];for(u=a;u<s.length;u++)c.push("..");return(c=c.concat(i.slice(a))).join("/")},r.sep="/",r.delimiter=":",r.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var r=e.charCodeAt(0),t=47===r,n=-1,s=!0,i=e.length-1;i>=1;--i)if(47===(r=e.charCodeAt(i))){if(!s){n=i;break}}else s=!1;return-1===n?t?"/":".":t&&1===n?"/":e.slice(0,n)},r.basename=function(e,r){var t=function(e){"string"!=typeof e&&(e+="");var r,t=0,n=-1,s=!0;for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!s){t=r+1;break}}else-1===n&&(s=!1,n=r+1);return-1===n?"":e.slice(t,n)}(e);return r&&t.substr(-1*r.length)===r&&(t=t.substr(0,t.length-r.length)),t},r.extname=function(e){"string"!=typeof e&&(e+="");for(var r=-1,t=0,n=-1,s=!0,i=0,o=e.length-1;o>=0;--o){var a=e.charCodeAt(o);if(47!==a)-1===n&&(s=!1,n=o+1),46===a?-1===r?r=o:1!==i&&(i=1):-1!==r&&(i=-1);else if(!s){t=o+1;break}}return-1===r||-1===n||0===i||1===i&&r===n-1&&r===t+1?"":e.slice(r,n)};var s="b"==="ab".substr(-1)?function(e,r,t){return e.substr(r,t)}:function(e,r,t){return r<0&&(r=e.length+r),e.substr(r,t)}}).call(this,t(0))},function(e,r,t){(function(e,r){const n=t(5),s=n(),i=t(6),o=t(1).applicationConfig.port||"5000";s.use(n.static(e+"./../../web/dist/")),console.log("process.env.mode production"),s.listen(o,()=>{console.log(`app listening ${o}`)}),s.use(i.urlencoded({extended:!1})),s.use(i.json()),s.use("/",t(13)({express:n})),s.use((function(e,r,t,n){console.error("ERROR CAUGHT ==============>",e.stack),t.status(500).send("Something broke!")})),r.on("unhandledRejection",(e,r)=>{console.log("\n\n\nUNHANDLED REJECTION  ==========>",e,r)}),r.on("uncaughtException",(function(e){console.log("UNCAUGHT EXCEPTION =============>",e)}))}).call(this,"server/src",t(0))},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("body-parser")},function(e,r,t){var n={"./development/tvdb.config.js":8,"./production/tvdb.config.js":9};function s(e){var r=i(e);return t(r)}function i(e){if(!t.o(n,e)){var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}return n[e]}s.keys=function(){return Object.keys(n)},s.resolve=i,e.exports=s,s.id=7},function(e,r,t){(function(r){console.log("process.env",r),e.exports={credentials:{username:r.env.TVDB_USERNAME,apikey:r.env.TVDB_API_KEY,uniqueId:r.env.TVDB_UNIQUE_ID},api:{login:"https://api.thetvdb.com/login",refreshToken:"https://api.thetvdb.com/refresh_token",searchSeriesByName:"https://api.thetvdb.com/search/series",getSeriesById:e=>`https://api.thetvdb.com/series/${e}`,getEpisodesForSeriesById:(e,r)=>`https://api.thetvdb.com/series/${e}/episodes?page=${r}`,getCastForSeriesById:e=>`https://api.thetvdb.com/series/${e}/actors`}}}).call(this,t(0))},function(e,r,t){(function(r){e.exports={credentials:{username:r.env.TVDB_USERNAME,apikey:r.env.TVDB_API_KEY,uniqueId:r.env.TVDB_UNIQUE_ID},api:{login:"https://api.thetvdb.com/login",refreshToken:"https://api.thetvdb.com/refresh_token",searchSeriesByName:"https://api.thetvdb.com/search/series",getSeriesById:e=>`https://api.thetvdb.com/series/${e}`,getEpisodesForSeriesById:(e,r)=>`https://api.thetvdb.com/series/${e}/episodes?page=${r}`,getCastForSeriesById:e=>`https://api.thetvdb.com/series/${e}/actors`}}}).call(this,t(0))},function(e,r,t){var n={"./development/application.config.js":11,"./production/application.config.js":12};function s(e){var r=i(e);return t(r)}function i(e){if(!t.o(n,e)){var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}return n[e]}s.keys=function(){return Object.keys(n)},s.resolve=i,e.exports=s,s.id=10},function(e,r){e.exports={port:4e3}},function(e,r){e.exports={port:4e3}},function(e,r,t){e.exports=({express:e})=>{const r=e.Router(),n=t(14)({express:e});r.use("/",n);const s=t(20)({express:e});return r.use("/",s),r}},function(e,r,t){const n=t(15);e.exports=({express:e})=>{const r=e.Router();return r.get("/api/series/",(e,r,t)=>{n.searchSeriesByName({series:{name:e.query.name}}).then(e=>{r.send(e)})}),r.get("/api/series/:id",(e,r,t)=>{n.searchSeriesById({series:{id:e.params.id}}).then(e=>{r.send(e)})}),r.get("/api/series/:id/episodes",(e,r,t)=>{n.getEpisodesForSeriesWithId({series:{id:e.params.id,page:e.query.page||"1"}}).then(e=>{r.send(e)})}),r.get("/api/series/:id/cast",(e,r,t)=>{n.getCastForSeriesWithId({series:{id:e.params.id}}).then(e=>{r.send(e)})}),r}},function(e,r,t){t(1).tvdbConfig,t(2)("TVDB.JS");const n=t(17);e.exports={searchSeriesByName:async function(e={}){return providerResponse=await n.searchSeriesByName(e),{err:null,data:{matchedSeriesList:providerResponse.res.data.data}}},searchSeriesById:async function(e={}){return providerResponse=await n.searchSeriesById(e),{err:null,data:{series:providerResponse.res.data.data}}},getEpisodesForSeriesWithId:async function(e={}){return providerResponse=await n.getEpisodesForSeriesWithId(e),{err:null,data:{episodes:providerResponse.res.data.data,pageInfo:{...providerResponse.res.data.links}}}},getCastForSeriesWithId:async function(e={}){return providerResponse=await n.getCastForSeriesWithId(e),{err:null,data:{castMembers:providerResponse.res.data.data}}}}},function(e,r){e.exports=require("winston")},function(e,r,t){const n=t(18),s=t(2)("TVDB_PROVIDER"),i=t(1).tvdbConfig;let o=null;async function a(e={}){return await n.makePOSTRequest({url:i.api.login,params:{apikey:i.credentials.apikey}}).then(e=>{if(e.err)throw new Error("Unexpected error");return s.info("successfully fetched auth token"),o=e.res.data.token,o})}async function u(e,r,t){if(err=e.err,res=e.res,err){if(err&&err.response&&"401"==err.response.status)return s.error("AUTH TOKEN expired, refreshing token"),o=await a(),apiRetryResponse=await r(t),apiRetryResponse;throw new Error("Unexpected error")}return e}async function c(e){return await n.makeGETRequest({url:`${i.api.searchSeriesByName}?name=${e.series.name}`,config:{headers:{...d()}},params:{name:e.series.name}})}async function p(e){return id=e.series.id,s.info("series id %s",id),await n.makeGETRequest({url:i.api.getSeriesById(e.series.id),config:{headers:{...d()}},params:{name:e.series.name}})}async function f(e){return id=e.series.id,s.info("series id %s",id),await n.makeGETRequest({url:i.api.getEpisodesForSeriesById(id,e.series.page),config:{headers:{...d()}}})}async function l(e){return id=e.series.id,s.info("series id %s",id),await n.makeGETRequest({url:i.api.getCastForSeriesById(id),config:{headers:{...d()}}})}!async function(){if(null==o)try{o=await a()}catch(e){throw new Error("Auth Token fetch Failure")}}();const d=()=>({Authorization:`Bearer ${o}`});e.exports={searchSeriesByName:async function(e){return response=await c(e).then(r=>u(r,apiRetryHandler=c,e)),response},searchSeriesById:async function(e){return response=await p(e).then(r=>u(r,apiRetryHandler=p,e)),response},getEpisodesForSeriesWithId:async function(e){return s.info("getEpisodesForSeriesWithId %s",JSON.stringify(e)),response=await f(e).then(r=>u(r,apiRetryHandler=f,e)),response},getCastForSeriesWithId:async function(e){return s.info("getCastForSeriesWithId %s",JSON.stringify(e)),response=await l(e).then(r=>u(r,apiRetryHandler=l,e)),response}}},function(e,r,t){const n=t(19),s=t(2)("TRANSPORT.JS");e.exports={makeGETRequest:async function(e){s.info("making GET CALL url: %s headers: %s",e.url,JSON.stringify(e.config.headers));try{return{err:null,res:await n.get(e.url,{...e.params,...e.config})}}catch(r){return s.info("response received, url: %s, res: %s",e.url,JSON.stringify(r.response&&r.response.data?r.response.data:{})),{err:r,res:null}}},makePOSTRequest:async function(e){s.info("making POST CALL url: %s data: %s",e.url,JSON.stringify(e.params));try{const r=await n.post(e.url,{...e.params,...e.config});return s.info("POST CALL response received, url: %s req: %s: res: %s",e.url,JSON.stringify(e.params),JSON.stringify(r.data)),{err:null,res:r}}catch(r){return s.error("POST CALL failure url: %s msg: %s",e.url,JSON.stringify(r.response&&r.response.data?r.response.data:{})),{err:r,res:null}}}}},function(e,r){e.exports=require("axios")},function(e,r,t){(function(r,n){const s=t(2)(r);t(3);e.exports=({express:e})=>{const r=e.Router();return r.get("/*",(e,r,t)=>{s.info("received call for %s",JSON.stringify(e.path)),r.sendFile("index.dist.html",{root:n+"../../../../../web/dist/"})}),r}}).call(this,"server/src/route/view/route.view.js","server/src/route/view")}]);